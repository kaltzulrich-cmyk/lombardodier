<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Lombard Odier ¬∑ Face verification</title>
  <!-- Google Font & Font Awesome 6 -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300;14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* --- same beautiful styling as before, plus a new secure-context warning --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: #f2efe9;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      position: relative;
      overflow-x: hidden;
    }
    /* watermarks (unchanged) */
    body::before, body::after {
      content: ""; position: fixed; width: 45%; height: 45%;
      background-image: url('https://andsimple.co/wp-content/uploads/2020/09/lombard-odier-500x500.jpg');
      background-repeat: no-repeat; background-size: contain; opacity: 0.05; filter: blur(8px); pointer-events: none; z-index: 0;
    }
    body::before { top: -5%; right: -5%; transform: rotate(3deg); }
    body::after { bottom: -8%; left: -5%; width: 50%; height: 50%; opacity: 0.04; filter: blur(16px); transform: rotate(-8deg); }

    .card {
      background: rgba(255,255,255,0.82); backdrop-filter: blur(16px) saturate(180%);
      border-radius: 40px; box-shadow: 0 30px 50px -20px rgba(0,43,74,0.18);
      width: 100%; max-width: 620px; padding: 2.5rem 2.2rem; position: relative; z-index: 20;
      border: 1px solid rgba(255,255,255,0.5);
    }
    /* Lombard Odier colours */
    .logo-crest { display: flex; flex-direction: column; align-items: center; margin-bottom: 1.8rem; }
    .logo-frame {
      width: 92px; height: 92px; background: white; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 10px 18px -6px rgba(0,43,74,0.12), 0 0 0 1px rgba(165,150,100,0.2); margin-bottom: 0.9rem;
    }
    .logo-frame img { width: 66px; height: 66px; object-fit: contain; }
    h1 { font-size: 1.7rem; font-weight: 600; color: #002b4a; margin-bottom: 0.2rem; }
    .brand-sub { font-size: 0.9rem; font-weight: 500; color: #a59064; text-transform: uppercase; letter-spacing: 2px; }
    .step-chip {
      display: inline-block; background: rgba(165,150,100,0.12); color: #002b4a;
      font-size: 0.7rem; font-weight: 600; padding: 0.35rem 1.2rem; border-radius: 60px;
      letter-spacing: 0.6px; text-transform: uppercase; border: 0.5px solid rgba(165,150,100,0.3);
      margin-bottom: 1.25rem; backdrop-filter: blur(4px);
    }

    /* --- CAMERA SECTION (unchanged layout) --- */
    .camera-stage { text-align: center; }
    .camera-viewport {
      width: 100%; aspect-ratio: 1 / 1; max-width: 280px; margin: 0 auto 1.2rem;
      background: #1e2c34; border-radius: 28px; overflow: hidden; position: relative;
      border: 2px solid rgba(165,150,100,0.5); box-shadow: 0 16px 30px -12px rgba(0,0,0,0.2);
    }
    #videoElement { width: 100%; height: 100%; object-fit: cover; display: block; }
    .camera-placeholder {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      width: 100%; height: 100%; background: #0f1e26; color: rgba(255,255,255,0.7);
    }
    .camera-placeholder i { font-size: 3.8rem; margin-bottom: 0.5rem; opacity: 0.7; }
    .camera-placeholder span { font-size: 0.8rem; background: rgba(0,0,0,0.5); padding: 0.3rem 1rem; border-radius: 40px; }
    .scan-overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(180deg, rgba(165,150,100,0) 0%, rgba(165,150,100,0.2) 30%, rgba(165,150,100,0.6) 50%, rgba(165,150,100,0.2) 70%, rgba(165,150,100,0) 100%);
      transform: translateY(-100%); pointer-events: none; z-index: 25;
    }
    .scan-overlay.active { animation: scanMove 1.8s cubic-bezier(0.23,1,0.32,1) forwards; }
    @keyframes scanMove {
      0% { transform: translateY(-100%); }
      20% { transform: translateY(-60%); }
      50% { transform: translateY(0%); }
      80% { transform: translateY(60%); }
      100% { transform: translateY(100%); }
    }
    .success-badge {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: rgba(0,171,107,0.9); backdrop-filter: blur(6px); width: 80px; height: 80px;
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      color: white; font-size: 2.8rem; opacity: 0; transition: opacity 0.2s; z-index: 30;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    .success-badge.show { opacity: 1; }

    .camera-actions { display: flex; justify-content: center; gap: 0.8rem; flex-wrap: wrap; margin: 1rem 0 0.2rem; }
    .btn {
      background: #002b4a; color: white; border: none; padding: 0.8rem 1.8rem; font-size: 0.9rem;
      font-weight: 550; border-radius: 50px; display: inline-flex; align-items: center; gap: 0.6rem;
      transition: all 0.2s; cursor: pointer; box-shadow: 0 10px 20px -8px rgba(0,43,74,0.25);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .btn:hover:not(:disabled) { background: #1e4057; transform: translateY(-1px); }
    .btn:disabled { background: #b1bbc3; cursor: not-allowed; opacity: 0.6; }
    .btn-outline { background: transparent; border: 1.8px solid #a59064; color: #002b4a; box-shadow: none; background: rgba(255,255,255,0.6); }
    .btn-outline:hover:not(:disabled) { background: #f5efe7; border-color: #8f7b52; }

    .verification-status {
      font-size: 0.9rem; margin-top: 0.8rem; padding: 0.7rem; border-radius: 40px;
      background: rgba(255,255,255,0.4); backdrop-filter: blur(6px); color: #002b4a; font-weight: 500;
    }
    .camera-error {
      color: #b34a4a; background: rgba(255,220,220,0.6); backdrop-filter: blur(4px);
      padding: 0.7rem; border-radius: 40px; font-size: 0.85rem; margin-top: 0.7rem;
      border: 0.5px solid rgba(180,80,80,0.2); text-align: left;
    }
    /* --- SECURE CONTEXT WARNING (new) --- */
    .secure-warning {
      background: #fcf3e0; border-left: 4px solid #a59064; padding: 0.8rem; border-radius: 16px;
      margin-bottom: 1rem; font-size: 0.8rem; color: #3e5a4a; display: flex; gap: 0.6rem;
    }
    .secure-warning i { color: #a59064; font-size: 1.2rem; }

    /* password step (unchanged) */
    .password-step { margin-top: 0.5rem; }
    .input-field { margin-bottom: 1.3rem; text-align: left; }
    .input-field label { display: block; font-size: 0.8rem; font-weight: 600; color: #3c5a6b; margin-bottom: 0.35rem; margin-left: 0.6rem; }
    .input-icon-wrapper { position: relative; display: flex; align-items: center; }
    .input-icon-wrapper i { position: absolute; left: 1.1rem; color: #a59064; font-size: 1rem; }
    .input-icon-wrapper input {
      width: 100%; padding: 0.9rem 1rem 0.9rem 3rem; border: 1px solid #dbd3ca;
      border-radius: 60px; font-size: 0.95rem; background: white; transition: all 0.2s;
    }
    .input-icon-wrapper input:focus { outline: none; border-color: #a59064; box-shadow: 0 0 0 3px rgba(165,150,100,0.2); }
    .error-msg { color: #c74545; font-size: 0.8rem; margin-top: 0.2rem; margin-left: 1rem; font-weight: 500; }
    .redirect-message { margin-top: 1.8rem; font-size: 0.8rem; background: rgba(165,150,100,0.08); padding: 0.8rem 1.2rem; border-radius: 60px; color: #2b4e5c; text-align: center; border: 0.5px solid rgba(165,150,100,0.3); }
    .hidden { display: none !important; }
    .divider { display: flex; align-items: center; color: #9eaca6; font-size: 0.7rem; margin: 1.8rem 0 0.8rem; }
    .divider::before, .divider::after { content: ""; flex: 1; height: 0.5px; background: linear-gradient(to right, transparent, #cbc3b8, transparent); }
    .permission-hint { font-size: 0.7rem; color: #667f8c; background: rgba(255,255,255,0.5); padding: 0.3rem 0.8rem; border-radius: 50px; display: inline-block; }
  </style>
</head>
<body>
  <div class="card">
    <div class="logo-crest">
      <div class="logo-frame"><img src="https://andsimple.co/wp-content/uploads/2020/09/lombard-odier-500x500.jpg" alt="Lombard Odier"></div>
      <h1>Private Banking</h1>
      <span class="brand-sub">Lombard Odier</span>
    </div>

    <!-- STEP 1 ‚Äì REAL CAMERA + SIMULATED FACE SCAN -->
    <div id="stepScan" class="scan-verify-step">
      <div class="step-chip"><i class="fas fa-shield-alt" style="margin-right: 0.4rem;"></i> step 1/2 ¬∑ face scan</div>
      
      <!-- üîê SECURE CONTEXT WARNING ‚Äì will be shown only if not HTTPS/localhost -->
      <div id="secureContextWarning" class="secure-warning hidden">
        <i class="fas fa-shield-haltered"></i>
        <div>
          <strong>Camera access requires HTTPS or localhost.</strong><br>
          You are currently viewing this page over an insecure connection. Please serve it via <code>https://</code> or <code>http://localhost</code> for the camera permission to work.
        </div>
      </div>

      <div class="camera-stage">
        <div class="camera-viewport">
          <video id="videoElement" autoplay playsinline muted class="hidden"></video>
          <div id="cameraPlaceholder" class="camera-placeholder">
            <i class="fas fa-video-slash"></i>
            <span>Camera inactive</span>
          </div>
          <div id="scanLine" class="scan-overlay"></div>
          <div id="successBadge" class="success-badge"><i class="fas fa-check"></i></div>
        </div>

        <div id="scanStatus" class="verification-status">
          <i class="fas fa-info-circle"></i> Camera access required
        </div>
        <div id="cameraError" class="camera-error hidden"></div>

        <div class="camera-actions">
          <button id="enableCameraBtn" class="btn">
            <i class="fas fa-video"></i> Enable camera
          </button>
          <button id="verifyBtn" class="btn btn-outline" disabled>
            <i class="fas fa-camera"></i> Verify face
          </button>
          <button id="resetBtn" class="btn-outline btn" disabled>
            <i class="fas fa-redo-alt"></i> Retry
          </button>
        </div>
        <div style="display: flex; justify-content: center; gap: 0.8rem; flex-wrap: wrap; margin-top: 0.3rem;">
          <span class="permission-hint"><i class="fas fa-lock" style="color:#a59064;"></i> HTTPS required for camera</span>
          <span class="permission-hint"><i class="fas fa-id-card"></i> simulated scan</span>
        </div>
      </div>
    </div>

    <!-- STEP 2 ‚Äì PASSWORD CHANGE (hidden initially) -->
    <div id="stepPassword" class="password-step hidden">
      <div class="step-chip"><i class="fas fa-lock" style="margin-right: 0.4rem;"></i> step 2/2 ¬∑ secure access</div>
      <h2 style="font-size:1.5rem; font-weight: 550; margin-bottom: 0.25rem;">Change password</h2>
      <p style="color: #4f6875; margin-bottom: 1.6rem; font-size:0.9rem;">Create a strong, unique passphrase</p>

      <div class="input-field">
        <label>New password</label>
        <div class="input-icon-wrapper">
          <i class="fas fa-lock"></i>
          <input type="password" id="newPw" placeholder="Enter new password" autocomplete="new-password">
        </div>
      </div>
      <div class="input-field">
        <label>Confirm password</label>
        <div class="input-icon-wrapper">
          <i class="fas fa-check-circle"></i>
          <input type="password" id="confirmPw" placeholder="Re-enter password" autocomplete="off">
        </div>
        <div id="pwError" class="error-msg"></div>
      </div>

      <button id="updatePwBtn" class="btn" style="width:100%; margin-top: 0.8rem;">
        <i class="fas fa-arrow-right-to-bracket"></i> Update & log in
      </button>

      <div class="redirect-message">
        <i class="fas fa-globe" style="margin-right: 0.5rem;"></i> You will be redirected to 
        <strong style="color:#002b4a;">lombardodierprivate.com</strong>
        <div class="fallback-link" id="fallbackRedirect">
          ‚èé If not redirected, <a href="#" id="manualRedirectLink" style="color:#a59064; text-decoration:underline;">click here</a>
        </div>
      </div>
    </div>

    <div class="divider">
      <span style="margin: 0 0.8rem; color: #8d9b9b;">private client ¬∑ jean wilondja msebengi</span>
    </div>
    <div style="display: flex; justify-content: center; gap: 1.2rem; font-size: 0.7rem; color: #8b9a9f;">
      <span><i class="far fa-clock"></i> session encrypted</span>
      <span><i class="fas fa-certificate"></i> iso 27001 certified</span>
    </div>
  </div>

  <script>
    (function() {
      'use strict';

      // ----- DOM -----
      const stepScan = document.getElementById('stepScan');
      const stepPw = document.getElementById('stepPassword');
      const video = document.getElementById('videoElement');
      const cameraPlaceholder = document.getElementById('cameraPlaceholder');
      const scanLine = document.getElementById('scanLine');
      const successBadge = document.getElementById('successBadge');
      const scanStatus = document.getElementById('scanStatus');
      const cameraErrorDiv = document.getElementById('cameraError');
      const enableCameraBtn = document.getElementById('enableCameraBtn');
      const verifyBtn = document.getElementById('verifyBtn');
      const resetBtn = document.getElementById('resetBtn');
      const newPw = document.getElementById('newPw');
      const confirmPw = document.getElementById('confirmPw');
      const pwError = document.getElementById('pwError');
      const updateBtn = document.getElementById('updatePwBtn');
      const manualRedirectLink = document.getElementById('manualRedirectLink');
      const secureWarning = document.getElementById('secureContextWarning');

      // ----- state -----
      let stream = null;
      let cameraActive = false;
      let verificationDone = false;
      let scanInProgress = false;

      // ----- helper: secure context check -----
      function isSecureContext() {
        return location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
      }

      // ----- show/hide secure context warning -----
      if (!isSecureContext()) {
        secureWarning.classList.remove('hidden');
      } else {
        secureWarning.classList.add('hidden');
      }

      // ----- stop all camera tracks -----
      function stopCamera() {
        if (stream) {
          stream.getTracks().forEach(track => {
            track.stop();
            stream.removeTrack(track);
          });
          stream = null;
        }
        video.srcObject = null;
      }

      // ----- reset UI to camera-off state -----
      function resetToCameraOff() {
        stopCamera();
        cameraActive = false;
        verificationDone = false;
        scanInProgress = false;
        
        video.classList.add('hidden');
        cameraPlaceholder.classList.remove('hidden');
        enableCameraBtn.disabled = false;
        verifyBtn.disabled = true;
        resetBtn.disabled = true;
        
        scanStatus.innerHTML = '<i class="fas fa-info-circle"></i> Camera access required';
        scanStatus.style.background = 'rgba(255,255,255,0.4)';
        scanStatus.style.color = '#002b4a';
        
        successBadge.classList.remove('show');
        scanLine.classList.remove('active');
        cameraErrorDiv.classList.add('hidden');
        cameraErrorDiv.textContent = '';
      }

      // ----- ENABLE CAMERA ‚Äì with proper permission request -----
      function enableCamera() {
        // Clear any previous error
        cameraErrorDiv.classList.add('hidden');
        cameraErrorDiv.textContent = '';
        
        // Stop any existing stream
        stopCamera();
        
        // Show placeholder and disable button while requesting
        video.classList.add('hidden');
        cameraPlaceholder.classList.remove('hidden');
        enableCameraBtn.disabled = true;
        scanStatus.innerHTML = '<i class="fas fa-spinner fa-pulse"></i> Requesting camera permission...';
        
        // üéØ REQUEST CAMERA ACCESS ‚Äì this triggers the browser prompt
        navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: 'user',
            width: { ideal: 640 },
            height: { ideal: 480 }
          },
          audio: false
        })
        .then((mediaStream) => {
          stream = mediaStream;
          video.srcObject = mediaStream;
          video.muted = true; // required for autoplay
          return video.play();
        })
        .then(() => {
          // Success: camera is live
          video.classList.remove('hidden');
          cameraPlaceholder.classList.add('hidden');
          
          cameraActive = true;
          verificationDone = false;
          scanInProgress = false;
          
          enableCameraBtn.disabled = true;
          verifyBtn.disabled = false;
          resetBtn.disabled = true; // reset only after verification
          
          scanStatus.innerHTML = `<i class="fas fa-circle" style="color:#47b347; margin-right:0.5rem;"></i> Camera active ¬∑ position your face`;
          scanStatus.style.background = 'rgba(70, 170, 70, 0.1)';
          scanStatus.style.color = '#1e6b3b';
          
          successBadge.classList.remove('show');
          scanLine.classList.remove('active');
        })
        .catch((err) => {
          // ‚ùå Permission denied or other error
          console.error('Camera error:', err);
          
          // Re-enable the enable button so user can try again
          enableCameraBtn.disabled = false;
          verifyBtn.disabled = true;
          resetBtn.disabled = true;
          cameraActive = false;
          
          // Show detailed error message
          cameraErrorDiv.classList.remove('hidden');
          
          let errorMsg = '';
          if (!isSecureContext()) {
            errorMsg = 'üîí Camera access is blocked because this page is not served over HTTPS or localhost. Please use a secure server.';
          } else if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
            errorMsg = 'üìµ Camera access denied. Please allow camera permission in your browser and click "Enable camera" again.';
          } else if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {
            errorMsg = 'üé• No camera found on this device.';
          } else if (err.name === 'NotReadableError' || err.name === 'TrackStartError') {
            errorMsg = '‚ö†Ô∏è Camera is already in use by another application. Please close other tabs/apps using the camera.';
          } else if (err.name === 'OverconstrainedError') {
            errorMsg = 'üîÑ Camera does not meet the requirements.';
          } else {
            errorMsg = `Camera access failed: ${err.message || 'Unknown error'}. If you are testing locally, use http://localhost.`;
          }
          cameraErrorDiv.textContent = errorMsg;
          
          scanStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Camera access failed';
          scanStatus.style.background = 'rgba(255,200,200,0.6)';
          scanStatus.style.color = '#a03a3a';
          
          video.classList.add('hidden');
          cameraPlaceholder.classList.remove('hidden');
        });
      }

      // ----- SIMULATED FACE SCAN (animation) -----
      function startVerification() {
        if (!cameraActive || verificationDone || scanInProgress) return;
        scanInProgress = true;
        verificationDone = false;
        
        verifyBtn.disabled = true;
        resetBtn.disabled = false;
        
        scanStatus.innerHTML = `<i class="fas fa-spinner fa-pulse" style="margin-right:0.5rem;"></i> Scanning face ...`;
        scanStatus.style.background = 'rgba(165,150,100,0.18)';
        scanStatus.style.color = '#002b4a';
        
        successBadge.classList.remove('show');
        scanLine.classList.remove('active');
        void scanLine.offsetWidth;
        scanLine.classList.add('active');
        
        setTimeout(() => {
          if (scanInProgress) {
            verificationDone = true;
            scanInProgress = false;
            successBadge.classList.add('show');
            scanLine.classList.remove('active');
            scanStatus.innerHTML = `<i class="fas fa-circle-check" style="color:#006647; margin-right:0.5rem;"></i> Face verified successfully`;
            scanStatus.style.background = 'rgba(0,171,107,0.1)';
            scanStatus.style.color = '#006647';
            verifyBtn.disabled = true;
            resetBtn.disabled = false;
            
            setTimeout(() => {
              if (verificationDone) {
                stepScan.classList.add('hidden');
                stepPw.classList.remove('hidden');
                newPw.focus();
              }
            }, 1200);
          }
        }, 1800);
      }

      function resetVerification() {
        if (!cameraActive) return;
        scanInProgress = false;
        verificationDone = false;
        scanLine.classList.remove('active');
        successBadge.classList.remove('show');
        scanStatus.innerHTML = `<i class="fas fa-circle" style="color:#47b347; margin-right:0.5rem;"></i> Camera active ¬∑ position your face`;
        scanStatus.style.background = 'rgba(70, 170, 70, 0.1)';
        scanStatus.style.color = '#1e6b3b';
        verifyBtn.disabled = false;
        resetBtn.disabled = true;
      }

      // ----- PASSWORD & REDIRECT -----
      function handlePasswordUpdate() {
        const newPass = newPw.value.trim();
        const confPass = confirmPw.value.trim();
        if (!newPass || !confPass) { pwError.textContent = 'Please fill in both fields.'; return; }
        if (newPass !== confPass) { pwError.textContent = 'Passwords do not match.'; return; }
        if (newPass.length < 6) { pwError.textContent = 'Password must be at least 6 characters.'; return; }
        pwError.textContent = '';
        updateBtn.disabled = true;
        updateBtn.innerHTML = '<i class="fas fa-spinner fa-pulse"></i> Updating...';
        setTimeout(() => { window.location.href = 'https://lombardodierprivate.com/'; }, 1000);
      }

      function fallbackRedirect(e) { e.preventDefault(); window.location.href = 'https://lombardodierprivate.com/'; }

      // ----- EVENT LISTENERS -----
      enableCameraBtn.addEventListener('click', enableCamera);
      verifyBtn.addEventListener('click', startVerification);
      resetBtn.addEventListener('click', resetVerification);
      updateBtn.addEventListener('click', handlePasswordUpdate);
      manualRedirectLink.addEventListener('click', fallbackRedirect);
      [newPw, confirmPw].forEach(input => {
        input.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); handlePasswordUpdate(); } });
        input.addEventListener('input', () => { pwError.textContent = ''; });
      });

      // ----- INIT -----
      resetToCameraOff();
      window.addEventListener('beforeunload', stopCamera);
    })();
  </script>
</body>
</html>
